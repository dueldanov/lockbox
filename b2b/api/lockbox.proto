syntax = "proto3";

package lockbox.b2b.api;

option go_package = "github.com/iotaledger/lockbox/v2/lockbox/b2b/api";

service LockBoxAPI {
    // LockScript operations
    rpc CompileScript(CompileScriptRequest) returns (CompileScriptResponse);
    rpc ExecuteScript(ExecuteScriptRequest) returns (ExecuteScriptResponse);
    rpc ValidateScript(ValidateScriptRequest) returns (ValidateScriptResponse);
    
    // Vault operations
    rpc CreateVault(CreateVaultRequest) returns (CreateVaultResponse);
    rpc GenerateKey(GenerateKeyRequest) returns (GenerateKeyResponse);
    rpc RotateKeys(RotateKeysRequest) returns (RotateKeysResponse);
    rpc GetVaultInfo(GetVaultInfoRequest) returns (VaultInfo);
    
    // Account operations
    rpc GetAccountInfo(GetAccountInfoRequest) returns (AccountInfo);
    rpc UpgradeTier(UpgradeTierRequest) returns (UpgradeTierResponse);
    rpc GetUsageStats(GetUsageStatsRequest) returns (UsageStats);
    
    // Transaction operations
    rpc SubmitTransaction(SubmitTransactionRequest) returns (SubmitTransactionResponse);
    rpc GetTransactionStatus(GetTransactionStatusRequest) returns (TransactionStatus);
    
    // Streaming operations
    rpc StreamTransactions(StreamTransactionsRequest) returns (stream Transaction);
    rpc StreamEvents(StreamEventsRequest) returns (stream Event);
}

// LockScript messages
message CompileScriptRequest {
    string source = 1;
    map<string, string> parameters = 2;
}

message CompileScriptResponse {
    string script_id = 1;
    bytes bytecode = 2;
    repeated string warnings = 3;
}

message ExecuteScriptRequest {
    string script_id = 1;
    map<string, string> environment = 2;
    uint64 gas_limit = 3;
}

message ExecuteScriptResponse {
    bool success = 1;
    string output = 2;
    uint64 gas_used = 3;
    repeated string logs = 4;
}

message ValidateScriptRequest {
    string source = 1;
}

message ValidateScriptResponse {
    bool valid = 1;
    repeated string errors = 2;
}

// Vault messages
message CreateVaultRequest {
    string name = 1;
    map<string, string> metadata = 2;
}

message CreateVaultResponse {
    string vault_id = 1;
}

message GenerateKeyRequest {
    string vault_id = 1;
    string key_type = 2;
    string key_name = 3;
}

message GenerateKeyResponse {
    string key_id = 1;
    string public_key = 2;
}

message RotateKeysRequest {
    string vault_id = 1;
    repeated string key_ids = 2;
}

message RotateKeysResponse {
    bool success = 1;
    map<string, string> new_key_ids = 2;
}

message GetVaultInfoRequest {
    string vault_id = 1;
}

message VaultInfo {
    string vault_id = 1;
    string owner = 2;
    int64 created_at = 3;
    int64 last_rotation = 4;
    repeated KeyInfo keys = 5;
    map<string, string> metadata = 6;
}

message KeyInfo {
    string key_id = 1;
    string key_type = 2;
    string key_name = 3;
    int64 created_at = 4;
    int64 expires_at = 5;
}

// Account messages
message GetAccountInfoRequest {
    string account_id = 1;
}

message AccountInfo {
    string account_id = 1;
    string tier = 2;
    int64 created_at = 3;
    int64 last_activity = 4;
    UsageStats usage = 5;
    map<string, string> metadata = 6;
}

message UpgradeTierRequest {
    string account_id = 1;
    string new_tier = 2;
}

message UpgradeTierResponse {
    bool success = 1;
    string message = 2;
}

message GetUsageStatsRequest {
    string account_id = 1;
}

message UsageStats {
    int32 transactions_hour = 1;
    int64 storage_used = 2;
    int32 contracts_deployed = 3;
    int64 last_reset = 4;
}

// Transaction messages
message SubmitTransactionRequest {
    bytes transaction_data = 1;
    string priority = 2;
}

message SubmitTransactionResponse {
    string transaction_id = 1;
    string status = 2;
}

message GetTransactionStatusRequest {
    string transaction_id = 1;
}

message TransactionStatus {
    string transaction_id = 1;
    string status = 2;
    int64 timestamp = 3;
    string block_id = 4;
    map<string, string> metadata = 5;
}

// Streaming messages
message StreamTransactionsRequest {
    string filter = 1;
    int64 start_time = 2;
}

message Transaction {
    string transaction_id = 1;
    bytes data = 2;
    int64 timestamp = 3;
    string sender = 4;
    string receiver = 5;
    map<string, string> metadata = 6;
}

message StreamEventsRequest {
    repeated string event_types = 1;
    string filter = 2;
}

message Event {
    string event_id = 1;
    string event_type = 2;
    int64 timestamp = 3;
    map<string, string> data = 4;
}